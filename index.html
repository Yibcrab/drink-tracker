<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>手搖是信仰 2026</title>
    <!-- APP 模式設定 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#F0F7FF">

    <!-- 載入核心零件：Tailwind, React, Babel -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            background-color: #F0F7FF; 
            margin: 0; padding: 0; 
            overflow: hidden; 
            position: fixed; width: 100%; height: 100%; 
        }
        #root { height: 100%; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 15s linear infinite; }
        * { -webkit-tap-highlight-color: transparent; outline: none; }
        
        /* 自定義動畫：漂浮感 */
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .animate-float { animation: float 4s ease-in-out infinite; }
    </style>
</head>
<body>
    <div id="root">
        <!-- 預載入畫面 -->
        <div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#F0F7FF;">
            <div style="width:40px; height:40px; border:4px solid #DBEAFE; border-top:4px solid #3B82F6; border-radius:50%; animation: spin-slow 1s linear infinite;"></div>
            <p style="color:#60A5FA; font-weight:900; margin-top:20px;">信仰啟動中...</p>
        </div>
    </div>

    <!-- React 程式碼區塊 -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- 內建圖標集 (不再依賴外部庫，保證顯示) ---
        const Icons = {
            Flower: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M12 7.5a4.5 4.5 0 1 1 4.5 4.5M12 7.5A4.5 4.5 0 1 0 7.5 12M12 7.5V9m-4.5 3a4.5 4.5 0 1 1 4.5-4.5M7.5 12H9m3 4.5a4.5 4.5 0 1 1-4.5-4.5M12 16.5V15m4.5-3a4.5 4.5 0 1 1-4.5 4.5M16.5 12H15" />
                    <circle cx="12" cy="12" r="3" />
                    <path d="m8 16 1.5-1.5" />
                    <path d="M14.5 9.5 16 8" />
                    <path d="m8 8 1.5 1.5" />
                    <path d="M14.5 14.5 16 16" />
                </svg>
            ),
            Star: ({size=24, className="", fill="none"}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                </svg>
            ),
            // 修正後的手搖杯圖標：線條直挺，像一杯珍珠奶茶
            CupSoda: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {/* 杯身 */}
                    <path d="M7 10v10a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V10" />
                    {/* 杯蓋 */}
                    <path d="M17 10H7l-1-4h12l-1 4z" />
                    {/* 吸管 */}
                    <line x1="12" x2="12" y1="2" y2="6" />
                </svg>
            ),
            Heart: ({size=24, className="", fill="none"}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                </svg>
            ),
            BarChart3: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M3 3v18h18" />
                    <path d="M18 17V9" />
                    <path d="M13 17V5" />
                    <path d="M8 17v-3" />
                </svg>
            ),
            DollarSign: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <line x1="12" x2="12" y1="2" y2="22" />
                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
                </svg>
            ),
            Store: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7" />
                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8" />
                    <path d="M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4" />
                    <path d="M2 7h20" />
                    <path d="M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7" />
                </svg>
            ),
            ChevronLeft: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="m15 18-6-6 6-6" />
                </svg>
            ),
            ChevronRight: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="m9 18 6-6-6-6" />
                </svg>
            ),
            X: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M18 6 6 18" />
                    <path d="m6 6 18 18" />
                </svg>
            ),
            Trash2: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M3 6h18" />
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                    <line x1="10" x2="10" y1="11" y2="17" />
                    <line x1="14" x2="14" y1="11" y2="17" />
                </svg>
            ),
            Coffee: ({size=24, className=""}) => (
                <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <path d="M17 8h1a4 4 0 1 1 0 8h-1" />
                    <path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z" />
                    <line x1="6" x2="6" y1="2" y2="4" />
                    <line x1="10" x2="10" y1="2" y2="4" />
                    <line x1="14" x2="14" y1="2" y2="4" />
                </svg>
            )
        };

        const App = () => {
            const [records, setRecords] = useState({});
            const [currentDate, setCurrentDate] = useState(new Date(2026, 0, 1));
            const [selectedDate, setSelectedDate] = useState(null);
            const [isModalOpen, setIsModalOpen] = useState(false);
            
            // 表單狀態
            const [form, setForm] = useState({ shop: '', item: '', price: '', ice: '微冰', sweetness: '微糖' });
            const iceOptions = ["正常", "少冰", "微冰", "去冰", "常溫"];
            const sweetnessOptions = ["全糖", "半糖", "微糖", "無糖"];

            // 1. 初始化：讀取資料
            useEffect(() => {
                const saved = localStorage.getItem('drink_faith_2026_final_stable');
                if (saved) {
                    try { setRecords(JSON.parse(saved)); } catch (e) { console.error(e); }
                }
            }, []);

            // 2. 統計數據
            const stats = useMemo(() => {
                const all = Object.values(records).flat();
                const shops = {};
                all.forEach(r => { if (r.shop) shops[r.shop] = (shops[r.shop] || 0) + 1; });
                const topShop = Object.entries(shops).sort((a, b) => b[1] - a[1])[0]?.[0] || '尚未紀錄';
                return {
                    count: all.length,
                    total: all.reduce((sum, r) => sum + (Number(r.price) || 0), 0),
                    topShop
                };
            }, [records]);

            // 3. 儲存與刪除
            const handleSave = () => {
                if (!form.shop || !form.item || !form.price) return;
                const newRecord = { ...form, price: Number(form.price), date: selectedDate, id: Date.now().toString() };
                const updated = { ...records, [selectedDate]: [...(records[selectedDate] || []), newRecord] };
                setRecords(updated);
                localStorage.setItem('drink_faith_2026_final_stable', JSON.stringify(updated));
                setForm({ shop: '', item: '', price: '', ice: '微冰', sweetness: '微糖' });
                setIsModalOpen(false);
            };

            const handleDelete = (id) => {
                const updatedDay = records[selectedDate].filter(r => r.id !== id);
                const updatedAll = { ...records, [selectedDate]: updatedDay };
                setRecords(updatedAll);
                localStorage.setItem('drink_faith_2026_final_stable', JSON.stringify(updatedAll));
            };

            // 日曆邏輯
            const daysInMonth = (y, m) => new Date(y, m + 1, 0).getDate();
            const firstDay = (y, m) => new Date(y, m, 1).getDay();

            return (
                <div className="min-h-screen bg-[#F0F7FF] relative pb-20 no-scrollbar overflow-x-hidden select-none">
                    {/* 背景可愛花花裝飾 - 補得更滿 */}
                    <div className="fixed inset-0 pointer-events-none z-0 opacity-30">
                        <div className="absolute top-10 left-10 animate-spin-slow text-blue-300">
                            <Icons.Flower size={80} />
                        </div>
                        <div className="absolute top-1/4 right-[-20px] text-pink-300 animate-float">
                            <Icons.Flower size={120} />
                        </div>
                        <div className="absolute bottom-40 left-[-10px] text-blue-200 animate-bounce" style={{animationDuration: '5s'}}>
                            <Icons.Flower size={60} />
                        </div>
                        <div className="absolute bottom-10 right-20 animate-spin-slow text-pink-200" style={{animationDuration: '20s'}}>
                            <Icons.Flower size={90} />
                        </div>
                        <div className="absolute top-1/2 left-1/4 text-yellow-200 opacity-40">
                            <Icons.Star size={40} fill="currentColor" />
                        </div>
                    </div>

                    <div className="relative z-10 max-w-md mx-auto">
                        <header className="pt-12 pb-6 px-6 text-center">
                            <div className="inline-block bg-white p-7 rounded-[3.5rem] shadow-2xl border-4 border-white mb-6 relative">
                                <div className="text-blue-400">
                                    <Icons.CupSoda size={64} />
                                </div>
                                <div className="absolute -top-3 -right-3 bg-pink-400 p-2.5 rounded-full border-4 border-white shadow-lg">
                                    <Icons.Heart size={20} fill="currentColor" className="text-white" />
                                </div>
                            </div>
                            <h1 className="text-4xl font-black text-blue-900 tracking-tight text-center">手搖是信仰 2026</h1>
                            <p className="text-blue-400 font-bold text-sm mt-4 flex items-center justify-center gap-2">
                                <Icons.Star size={16} fill="currentColor" className="text-yellow-300" />
                                什麼時候能戒掉呢
                                <Icons.Star size={16} fill="currentColor" className="text-yellow-300" />
                            </p>

                            <div className="grid grid-cols-3 gap-3 mt-10 px-2">
                                <div className="bg-white/90 backdrop-blur-md p-4 rounded-[2rem] shadow-sm border border-white flex flex-col items-center">
                                    <Icons.BarChart3 size={22} className="text-blue-300 mb-1" />
                                    <span className="text-[10px] font-black text-slate-300 uppercase">總杯數</span>
                                    <span className="text-base font-black text-slate-700">{stats.count} 杯</span>
                                </div>
                                <div className="bg-white/90 backdrop-blur-md p-4 rounded-[2rem] shadow-sm border border-white flex flex-col items-center">
                                    <Icons.DollarSign size={22} className="text-pink-300 mb-1" />
                                    <span className="text-[10px] font-black text-slate-300 uppercase">總開銷</span>
                                    <span className="text-base font-black text-slate-700">${stats.total}</span>
                                </div>
                                <div className="bg-white/90 backdrop-blur-md p-4 rounded-[2rem] shadow-sm border border-white flex flex-col items-center overflow-hidden text-center">
                                    <Icons.Store size={22} className="text-blue-300 mb-1" />
                                    <span className="text-[10px] font-black text-slate-300 uppercase">最愛店</span>
                                    <span className="text-[10px] font-black text-slate-700 truncate w-full px-1">{stats.topShop}</span>
                                </div>
                            </div>
                        </header>

                        <main className="px-5 pb-12">
                            <div className="bg-white/95 backdrop-blur-md rounded-[4rem] shadow-2xl border-[12px] border-white overflow-hidden p-1 shadow-blue-100/50">
                                <div className="flex items-center justify-between px-8 py-7 bg-blue-50/40">
                                    <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1))} className="p-2 text-blue-400 active:scale-75 transition-transform">
                                        <Icons.ChevronLeft size={32} />
                                    </button>
                                    <h2 className="text-2xl font-black text-slate-800 tracking-widest text-center">
                                        {currentDate.getFullYear()} / {currentDate.getMonth() + 1}
                                    </h2>
                                    <button onClick={() => setCurrentDate(new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 1))} className="p-2 text-blue-400 active:scale-75 transition-transform">
                                        <Icons.ChevronRight size={32} />
                                    </button>
                                </div>
                                
                                <div className="grid grid-cols-7 text-center pt-6 pb-3 px-6">
                                    {['日', '一', '二', '三', '四', '五', '六'].map(d => (
                                        <div key={d} className="text-[11px] font-black text-blue-200 uppercase tracking-widest">{d}</div>
                                    ))}
                                </div>

                                <div className="grid grid-cols-7 gap-2 px-6 pb-12">
                                    {Array.from({ length: firstDay(currentDate.getFullYear(), currentDate.getMonth()) }).map((_, i) => (
                                        <div key={`empty-${i}`} />
                                    ))}
                                    {Array.from({ length: daysInMonth(currentDate.getFullYear(), currentDate.getMonth()) }).map((_, i) => {
                                        const day = i + 1;
                                        const dateStr = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                                        const hasRecord = records[dateStr]?.length > 0;
                                        
                                        return (
                                            <div key={day} onClick={() => { setSelectedDate(dateStr); setIsModalOpen(true); }}
                                                className={`h-12 flex items-center justify-center rounded-2xl font-black text-sm transition-all relative cursor-pointer
                                                ${hasRecord ? 'bg-blue-500 text-white shadow-lg shadow-blue-200 scale-105' : 'bg-slate-50 text-slate-300 active:bg-blue-50'}`}>
                                                {day}
                                                {hasRecord && (
                                                    <div className="absolute top-1.5 right-1.5 w-2 h-2 bg-pink-400 rounded-full border-2 border-white" />
                                                )}
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            
                            <div className="mt-14 mb-10 text-center">
                                <p className="text-xs font-black text-blue-300/80 flex items-center justify-center gap-3 tracking-widest uppercase bg-white/40 inline-block px-8 py-3 rounded-full border border-white">
                                    <Icons.Flower size={16} /> 今天先喝一杯，明天開始一定戒 ! <Icons.Flower size={16} />
                                </p>
                            </div>
                        </main>
                    </div>

                    {isModalOpen && (
                        <div className="fixed inset-0 z-[100] flex items-end justify-center bg-blue-900/40 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-md h-[94vh] rounded-t-[4.5rem] shadow-2xl flex flex-col border-t-[14px] border-white animate-in slide-in-from-bottom duration-500">
                                <div className="w-12 h-1.5 bg-slate-100 rounded-full mx-auto mt-5 shrink-0" />
                                
                                <div className="px-10 py-8 flex justify-between items-center shrink-0">
                                    <div className="flex items-center gap-4 text-slate-800">
                                        <Icons.Heart size={28} fill="currentColor" className="text-pink-400" />
                                        <h3 className="text-2xl font-black">{selectedDate}</h3>
                                    </div>
                                    <button onClick={() => setIsModalOpen(false)} className="p-3 bg-slate-50 text-slate-400 rounded-full active:scale-90 transition-transform">
                                        <Icons.X size={28} />
                                    </button>
                                </div>

                                <div className="px-10 pb-12 overflow-y-auto flex-1 no-scrollbar space-y-12">
                                    <div className="space-y-6">
                                        {records[selectedDate]?.map(r => (
                                            <div key={r.id} className="bg-slate-50 p-6 rounded-[3rem] flex justify-between items-center border border-slate-100 shadow-sm animate-in zoom-in duration-300">
                                                <div>
                                                    <p className="font-black text-slate-800 text-xl leading-tight">{r.shop} / {r.item}</p>
                                                    <div className="flex gap-2.5 mt-2.5">
                                                        <span className="text-[11px] font-black bg-blue-100 text-blue-500 px-4 py-1 rounded-full uppercase tracking-tighter">{r.ice}</span>
                                                        <span className="text-[11px] font-black bg-blue-100 text-blue-500 px-4 py-1 rounded-full uppercase tracking-tighter">{r.sweetness}</span>
                                                        <span className="text-[11px] font-black bg-pink-400 text-white px-4 py-1 rounded-full shadow-sm">$ {r.price}</span>
                                                    </div>
                                                </div>
                                                <button onClick={() => handleDelete(r.id)} className="p-4 bg-white text-pink-300 rounded-[1.8rem] shadow-sm active:bg-pink-500 active:text-white transition-all">
                                                    <Icons.Trash2 size={24} />
                                                </button>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="bg-white p-8 rounded-[4rem] border-[8px] border-blue-50 shadow-inner space-y-8">
                                        <h4 className="text-center font-black text-blue-900 tracking-widest uppercase text-base flex items-center justify-center gap-2">
                                            <Icons.Coffee size={20} /> 收藏這一杯✨
                                        </h4>
                                        
                                        <div className="grid grid-cols-2 gap-5">
                                            <div className="space-y-2">
                                                <label className="text-[11px] font-black text-slate-300 ml-6 uppercase">店家</label>
                                                <input type="text" placeholder="例如：50嵐" value={form.shop} onInput={e => setForm({...form, shop: e.target.value})} 
                                                    className="w-full bg-slate-50 border-none rounded-3xl px-6 py-5 font-black text-slate-700 outline-none focus:ring-4 ring-blue-100" />
                                            </div>
                                            <div className="space-y-2">
                                                <label className="text-[11px] font-black text-slate-300 ml-6 uppercase">品項</label>
                                                <input type="text" placeholder="例如：珍珠奶茶" value={form.item} onInput={e => setForm({...form, item: e.target.value})} 
                                                    className="w-full bg-slate-50 border-none rounded-3xl px-6 py-5 font-black text-slate-700 outline-none focus:ring-4 ring-blue-100" />
                                            </div>
                                        </div>

                                        <div className="space-y-4">
                                            <label className="text-[11px] font-black text-slate-300 ml-6 uppercase">冰塊 / 甜度</label>
                                            <div className="flex gap-4">
                                                <select value={form.ice} onChange={e => setForm({...form, ice: e.target.value})} className="flex-1 bg-slate-50 border-none rounded-[1.5rem] px-6 py-5 font-bold text-slate-600 outline-none cursor-pointer">
                                                    {iceOptions.map(o => <option key={o} value={o}>{o}</option>)}
                                                </select>
                                                <select value={form.sweetness} onChange={e => setForm({...form, sweetness: e.target.value})} className="flex-1 bg-slate-50 border-none rounded-[1.5rem] px-6 py-5 font-bold text-slate-600 outline-none cursor-pointer">
                                                    {sweetnessOptions.map(o => <option key={o} value={o}>{o}</option>)}
                                                </select>
                                            </div>
                                        </div>

                                        <div className="relative">
                                            <span className="absolute left-8 top-1/2 -translate-y-1/2 font-black text-slate-200 text-5xl leading-none">$</span>
                                            <input type="number" placeholder="0" value={form.price} onInput={e => setForm({...form, price: e.target.value})} 
                                                className="w-full bg-slate-50 border-none rounded-[3.5rem] pl-20 pr-10 py-10 font-black text-slate-800 text-6xl outline-none focus:ring-4 ring-blue-100" />
                                        </div>

                                        <button onClick={handleSave} className="w-full py-8 bg-gradient-to-br from-blue-400 to-blue-600 text-white rounded-[3.5rem] font-black text-2xl shadow-xl shadow-blue-100 active:scale-95 transition-all flex items-center justify-center gap-5">
                                            <Icons.Heart size={28} fill="currentColor" className="text-pink-200" /> 收藏這一杯
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>